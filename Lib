local SimpleKavo = {}

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local Themes = {
    Dark = {SchemeColor = Color3.fromRGB(64,64,64), Background = Color3.fromRGB(0,0,0), Header = Color3.fromRGB(0,0,0), TextColor = Color3.fromRGB(255,255,255), ElementColor = Color3.fromRGB(20,20,20)},
    Default = {SchemeColor = Color3.fromRGB(74,99,135), Background = Color3.fromRGB(36,37,43), Header = Color3.fromRGB(28,29,34), TextColor = Color3.fromRGB(255,255,255), ElementColor = Color3.fromRGB(32,32,38)},
    Blood = {SchemeColor = Color3.fromRGB(227,27,27), Background = Color3.fromRGB(10,10,10), Header = Color3.fromRGB(5,5,5), TextColor = Color3.fromRGB(255,255,255), ElementColor = Color3.fromRGB(20,20,20)},
    Halloween = {SchemeColor = Color3.fromRGB(245,73,39), Background = Color3.fromRGB(0,0,0), Header = Color3.fromRGB(0,0,0), TextColor = Color3.fromRGB(255,255,255), ElementColor = Color3.fromRGB(20,20,20)}
}

local function Tween(obj, props, time)
    local ti = TweenInfo.new(time or 0.22, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local t = TweenService:Create(obj, ti, props)
    t:Play()
    return t
end

local function MakeDraggable(frame, dragArea)
    dragArea = dragArea or frame
    local dragging, dragInput, mousePos, framePos

    dragArea.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            mousePos = input.Position
            framePos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)

    dragArea.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - mousePos
            frame.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X, framePos.Y.Scale, framePos.Y.Offset + delta.Y)
        end
    end)
end

function SimpleKavo.CreateLib(title, themeName)
    local theme = Themes[themeName] or Themes.Default

    local sg = Instance.new("ScreenGui")
    sg.Name = "SimpleKavoUI"
    sg.ResetOnSpawn = false
    sg.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    sg.DisplayOrder = 999
    sg.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

    local Main = Instance.new("Frame")
    Main.Name = "Main"
    Main.Parent = sg
    Main.BackgroundColor3 = theme.Background
    Main.Position = UDim2.new(0.3,0,0.3,0)
    Main.Size = UDim2.new(0,500,0,350)
    Main.ClipsDescendants = true

    local mc = Instance.new("UICorner")
    mc.CornerRadius = UDim.new(0,6)
    mc.Parent = Main

    local Header = Instance.new("Frame")
    Header.Name = "Header"
    Header.Parent = Main
    Header.BackgroundColor3 = theme.Header
    Header.Size = UDim2.new(1,0,0,30)

    local hc = Instance.new("UICorner")
    hc.CornerRadius = UDim.new(0,6)
    hc.Parent = Header

    local Title = Instance.new("TextLabel")
    Title.Parent = Header
    Title.BackgroundTransparency = 1
    Title.Position = UDim2.new(0.03,0,0,0)
    Title.Size = UDim2.new(0.5,0,1,0)
    Title.Font = Enum.Font.GothamSemibold
    Title.Text = title
    Title.TextColor3 = theme.TextColor
    Title.TextSize = 15
    Title.TextXAlignment = Enum.TextXAlignment.Left

    local Close = Instance.new("ImageButton")
    Close.Parent = Header
    Close.BackgroundTransparency = 1
    Close.AnchorPoint = Vector2.new(1,0)
    Close.Position = UDim2.new(1,-8,0.5,0)
    Close.Size = UDim2.new(0,18,0,18)
    Close.Image = "rbxassetid://3926305904"
    Close.ImageRectOffset = Vector2.new(284,4)
    Close.ImageRectSize = Vector2.new(24,24)
    Close.ImageColor3 = theme.TextColor
    Close.ScaleType = Enum.ScaleType.Fit

    Close.MouseButton1Click:Connect(function()
        Tween(Main, {Size = UDim2.new(0,0,0,0)})
        task.delay(0.28, sg.Destroy, sg)
    end)

    MakeDraggable(Header, Main)

    local TabsScroll = Instance.new("ScrollingFrame")
    TabsScroll.Name = "Tabs"
    TabsScroll.Parent = Main
    TabsScroll.BackgroundTransparency = 1
    TabsScroll.Position = UDim2.new(0,16,0,36)
    TabsScroll.Size = UDim2.new(0,138,1,-44)
    TabsScroll.ScrollBarThickness = 4
    TabsScroll.ScrollBarImageColor3 = theme.SchemeColor
    TabsScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
    TabsScroll.CanvasSize = UDim2.new(0,0,0,0)

    local TabsHolder = Instance.new("Frame")
    TabsHolder.Name = "Holder"
    TabsHolder.Parent = TabsScroll
    TabsHolder.BackgroundTransparency = 1
    TabsHolder.Size = UDim2.new(1,0,0,0)
    TabsHolder.AutomaticSize = Enum.AutomaticSize.Y

    local TabsList = Instance.new("UIListLayout")
    TabsList.Parent = TabsHolder
    TabsList.Padding = UDim.new(0,6)
    TabsList.SortOrder = Enum.SortOrder.LayoutOrder

    local Content = Instance.new("Frame")
    Content.Name = "Content"
    Content.Parent = Main
    Content.BackgroundTransparency = 1
    Content.Position = UDim2.new(0,160,0,36)
    Content.Size = UDim2.new(1,-168,1,-44)

    local tabs = {}
    local currentTabButton = nil

    local minimized = false
    UserInputService.InputBegan:Connect(function(input, gpe)
        if gpe then return end
        if input.KeyCode == Enum.KeyCode.F1 then
            minimized = not minimized
            Tween(Main, {Size = minimized and UDim2.new(0,0,0,0) or UDim2.new(0,500,0,350)})
        end
    end)

    local lib = {}

    function lib:AddTab(name)
        local btn = Instance.new("TextButton")
        btn.Name = name
        btn.Parent = TabsHolder
        btn.BackgroundColor3 = theme.ElementColor
        btn.Size = UDim2.new(1,-12,0,32)
        btn.Font = Enum.Font.Gotham
        btn.Text = name
        btn.TextColor3 = theme.TextColor
        btn.TextSize = 14
        btn.AutoButtonColor = false

        local c = Instance.new("UICorner")
        c.CornerRadius = UDim.new(0,5)
        c.Parent = btn

        local tabContent = Instance.new("ScrollingFrame")
        tabContent.Name = name.."_Content"
        tabContent.Parent = Content
        tabContent.BackgroundTransparency = 1
        tabContent.Size = UDim2.new(1,0,1,0)
        tabContent.Visible = false
        tabContent.ScrollBarThickness = 4
        tabContent.ScrollBarImageColor3 = theme.SchemeColor
        tabContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
        tabContent.CanvasSize = UDim2.new(0,0,0,0)

        local list = Instance.new("UIListLayout")
        list.Parent = tabContent
        list.Padding = UDim.new(0,10)
        list.HorizontalAlignment = Enum.HorizontalAlignment.Center

        table.insert(tabs, {button = btn, content = tabContent})

        btn.MouseButton1Click:Connect(function()
            for _, t in ipairs(tabs) do
                t.content.Visible = false
                Tween(t.button, {BackgroundColor3 = theme.ElementColor})
            end
            tabContent.Visible = true
            Tween(btn, {BackgroundColor3 = theme.SchemeColor})
            currentTabButton = btn
        end)

        if #tabs == 1 then
            tabContent.Visible = true
            Tween(btn, {BackgroundColor3 = theme.SchemeColor})
            currentTabButton = btn
        end

        local tab = {}

        function tab:NewSection(name)
            local sec = Instance.new("Frame")
            sec.Name = name.."_Section"
            sec.Parent = tabContent
            sec.BackgroundTransparency = 1
            sec.Size = UDim2.new(0.96,0,0,0)
            sec.AutomaticSize = Enum.AutomaticSize.Y

            local lbl = Instance.new("TextLabel")
            lbl.Name = "Title"
            lbl.Parent = sec
            lbl.BackgroundTransparency = 1
            lbl.Size = UDim2.new(1,0,0,26)
            lbl.Font = Enum.Font.GothamSemibold
            lbl.Text = name
            lbl.TextColor3 = theme.TextColor
            lbl.TextSize = 14
            lbl.TextXAlignment = Enum.TextXAlignment.Left

            local line = Instance.new("Frame")
            line.Name = "Line"
            line.Parent = sec
            line.BackgroundColor3 = theme.SchemeColor
            line.BorderSizePixel = 0
            line.Position = UDim2.new(0,0,0,24)
            line.Size = UDim2.new(1,0,0,1)

            local secContent = Instance.new("Frame")
            secContent.Name = "Content"
            secContent.Parent = sec
            secContent.BackgroundTransparency = 1
            secContent.Position = UDim2.new(0,0,0,32)
            secContent.Size = UDim2.new(1,0,0,0)
            secContent.AutomaticSize = Enum.AutomaticSize.Y

            local seclist = Instance.new("UIListLayout")
            seclist.Parent = secContent
            seclist.Padding = UDim.new(0,6)
            seclist.HorizontalAlignment = Enum.HorizontalAlignment.Center

            seclist:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                sec.Size = UDim2.new(0.96,0,0, seclist.AbsoluteContentSize.Y + 34)
            end)

            local section = {}

            function section:NewButton(name, desc, callback)
                local b = Instance.new("TextButton")
                b.Name = name
                b.Parent = secContent
                b.BackgroundColor3 = theme.ElementColor
                b.Size = UDim2.new(1,0,0,34)
                b.Font = Enum.Font.Gotham
                b.Text = name
                b.TextColor3 = theme.TextColor
                b.TextSize = 14
                b.AutoButtonColor = false

                local bc = Instance.new("UICorner")
                bc.CornerRadius = UDim.new(0,5)
                bc.Parent = b

                if desc and desc ~= "" then
                    local d = Instance.new("TextLabel")
                    d.Name = "Desc"
                    d.Parent = b
                    d.BackgroundTransparency = 1
                    d.Position = UDim2.new(0,12,0,20)
                    d.Size = UDim2.new(1,-24,0,12)
                    d.Font = Enum.Font.Gotham
                    d.Text = desc
                    d.TextColor3 = theme.TextColor
                    d.TextSize = 11
                    d.TextTransparency = 0.3
                    d.TextXAlignment = Enum.TextXAlignment.Left
                end

                b.MouseEnter:Connect(function() Tween(b, {BackgroundColor3 = theme.ElementColor:Lerp(Color3.new(1,1,1),0.08)}) end)
                b.MouseLeave:Connect(function() Tween(b, {BackgroundColor3 = theme.ElementColor}) end)
                b.MouseButton1Click:Connect(function() if callback then callback() end end)

                return b
            end

            function section:NewToggle(name, desc, callback)
                local tf = Instance.new("Frame")
                tf.Name = name.."_Toggle"
                tf.Parent = secContent
                tf.BackgroundTransparency = 1
                tf.Size = UDim2.new(1,0,0, desc and 50 or 35)

                local tb = Instance.new("TextButton")
                tb.Name = "Toggle"
                tb.Parent = tf
                tb.BackgroundColor3 = theme.ElementColor
                tb.Size = UDim2.new(0,30,0,30)
                tb.Position = UDim2.new(1,-35,0,2)
                tb.Text = ""
                tb.AutoButtonColor = false

                local tc = Instance.new("UICorner")
                tc.CornerRadius = UDim.new(0,4)
                tc.Parent = tb

                local tl = Instance.new("TextLabel")
                tl.Parent = tf
                tl.BackgroundTransparency = 1
                tl.Position = UDim2.new(0,10,0,0)
                tl.Size = UDim2.new(0.7,0,0,35)
                tl.Font = Enum.Font.Gotham
                tl.Text = name
                tl.TextColor3 = theme.TextColor
                tl.TextSize = 14
                tl.TextXAlignment = Enum.TextXAlignment.Left

                if desc then
                    local dd = Instance.new("TextLabel")
                    dd.Parent = tf
                    dd.BackgroundTransparency = 1
                    dd.Position = UDim2.new(0,10,0,25)
                    dd.Size = UDim2.new(0.7,0,0,15)
                    dd.Font = Enum.Font.Gotham
                    dd.Text = desc
                    dd.TextColor3 = theme.TextColor
                    dd.TextSize = 10
                    dd.TextXAlignment = Enum.TextXAlignment.Left
                end

                local state = false
                local function upd() Tween(tb, {BackgroundColor3 = state and theme.SchemeColor or theme.ElementColor}) end
                upd()

                tb.MouseButton1Click:Connect(function()
                    state = not state
                    upd()
                    if callback then callback(state) end
                end)

                return tf
            end

            function section:NewDropdown(name, options, default, callback)
                local df = Instance.new("Frame")
                df.Name = name.."_Dropdown"
                df.Parent = secContent
                df.BackgroundTransparency = 1
                df.Size = UDim2.new(1,0,0,35)
                df.ClipsDescendants = true

                local mb = Instance.new("TextButton")
                mb.Name = "Main"
                mb.Parent = df
                mb.BackgroundColor3 = theme.ElementColor
                mb.Size = UDim2.new(1,0,0,35)
                mb.Font = Enum.Font.Gotham
                mb.Text = name..": "..(default or (options and options[1]) or "Selecione")
                mb.TextColor3 = theme.TextColor
                mb.TextSize = 14
                mb.TextXAlignment = Enum.TextXAlignment.Left
                mb.AutoButtonColor = false

                local bc = Instance.new("UICorner")
                bc.CornerRadius = UDim.new(0,4)
                bc.Parent = mb

                local arr = Instance.new("TextLabel")
                arr.Name = "Arrow"
                arr.Parent = mb
                arr.BackgroundTransparency = 1
                arr.Size = UDim2.new(0,20,0,20)
                arr.Position = UDim2.new(1,-25,0,7)
                arr.Text = "▼"
                arr.TextColor3 = theme.TextColor
                arr.Font = Enum.Font.Gotham
                arr.TextSize = 14

                local of = Instance.new("Frame")
                of.Name = "Options"
                of.Parent = df
                of.BackgroundColor3 = theme.ElementColor
                of.Position = UDim2.new(0,0,0,40)
                of.Size = UDim2.new(1,0,0,0)
                of.Visible = false
                of.ClipsDescendants = true

                local oc = Instance.new("UICorner")
                oc.CornerRadius = UDim.new(0,4)
                oc.Parent = of

                local ol = Instance.new("UIListLayout")
                ol.Parent = of
                ol.Padding = UDim.new(0,5)
                ol.HorizontalAlignment = Enum.HorizontalAlignment.Left

                local selected = default or (options and options[1]) or "Selecione"
                local open = false

                local function createOpts()
                    for _,c in of:GetChildren() do if c:IsA("TextButton") then c:Destroy() end end
                    if not options or #options == 0 then
                        local no = Instance.new("TextLabel")
                        no.Parent = of
                        no.BackgroundTransparency = 1
                        no.Size = UDim2.new(1,0,0,30)
                        no.Text = "Sem opções"
                        no.TextColor3 = theme.TextColor
                        no.Font = Enum.Font.Gotham
                        no.TextSize = 12
                        return
                    end
                    for _,opt in ipairs(options) do
                        local ob = Instance.new("TextButton")
                        ob.Name = tostring(opt)
                        ob.Parent = of
                        ob.BackgroundColor3 = theme.ElementColor
                        ob.Size = UDim2.new(1,-10,0,30)
                        ob.Position = UDim2.new(0,5,0,0)
                        ob.Font = Enum.Font.Gotham
                        ob.Text = tostring(opt)
                        ob.TextColor3 = theme.TextColor
                        ob.TextSize = 14
                        ob.AutoButtonColor = false

                        local obc = Instance.new("UICorner")
                        obc.CornerRadius = UDim.new(0,4)
                        obc.Parent = ob

                        ob.MouseButton1Click:Connect(function()
                            selected = opt
                            mb.Text = name..": "..tostring(selected)
                            open = false
                            of.Visible = false
                            Tween(of, {Size = UDim2.new(1,0,0,0)})
                            Tween(df, {Size = UDim2.new(1,0,0,35)})
                            Tween(arr, {Rotation = 0})
                            if callback then callback(opt) end
                        end)

                        ob.MouseEnter:Connect(function() Tween(ob, {BackgroundColor3 = theme.ElementColor:Lerp(Color3.new(1,1,1),0.08)}) end)
                        ob.MouseLeave:Connect(function() Tween(ob, {BackgroundColor3 = theme.ElementColor}) end)
                    end
                end

                createOpts()

                local function toggle()
                    open = not open
                    Tween(arr, {Rotation = open and 180 or 0})
                    if open then
                        local h = #options * 35 + (#options-1)*5
                        of.Visible = true
                        Tween(df, {Size = UDim2.new(1,0,0,35 + h + 5)})
                        Tween(of, {Size = UDim2.new(1,0,0,h)})
                    else
                        Tween(df, {Size = UDim2.new(1,0,0,35)})
                        Tween(of, {Size = UDim2.new(1,0,0,0)})
                        task.delay(0.22, function() of.Visible = false end)
                    end
                end

                mb.MouseButton1Click:Connect(toggle)

                local conn
                conn = UserInputService.InputBegan:Connect(function(i)
                    if i.UserInputType == Enum.UserInputType.MouseButton1 and open then
                        local p = i.Position
                        local fp = df.AbsolutePosition
                        local fs = df.AbsoluteSize
                        if not (p.X >= fp.X and p.X <= fp.X + fs.X and p.Y >= fp.Y and p.Y <= fp.Y + fs.Y) then
                            toggle()
                        end
                    end
                end)

                df.Destroying:Connect(function() conn:Disconnect() end)

                local methods = {}
                function methods:Set(v) if table.find(options, v) then selected = v mb.Text = name..": "..tostring(v) end end
                function methods:Get() return selected end
                function methods:Update(newOpts, newDef)
                    options = newOpts or options
                    selected = newDef or selected or (options[1] or "Selecione")
                    mb.Text = name..": "..tostring(selected)
                    createOpts()
                    if open then toggle() end
                end

                return methods
            end

            function section:NewTextBox(name, placeholder, callback)
                local tbf = Instance.new("Frame")
                tbf.Name = name.."_TextBox"
                tbf.Parent = secContent
                tbf.BackgroundTransparency = 1
                tbf.Size = UDim2.new(1,0,0,35)

                local tb = Instance.new("TextBox")
                tb.Name = "Input"
                tb.Parent = tbf
                tb.BackgroundColor3 = theme.ElementColor
                tb.Size = UDim2.new(1,0,0,30)
                tb.Position = UDim2.new(0,0,0,5)
                tb.Font = Enum.Font.Gotham
                tb.PlaceholderText = placeholder or "Digite aqui..."
                tb.Text = ""
                tb.TextColor3 = theme.TextColor
                tb.TextSize = 14
                tb.TextXAlignment = Enum.TextXAlignment.Left
                tb.ClearTextOnFocus = false

                local tbc = Instance.new("UICorner")
                tbc.CornerRadius = UDim.new(0,4)
                tbc.Parent = tb

                local tbl = Instance.new("TextLabel")
                tbl.Parent = tbf
                tbl.BackgroundTransparency = 1
                tbl.Size = UDim2.new(1,0,0,20)
                tbl.Position = UDim2.new(0,5,0,0)
                tbl.Font = Enum.Font.Gotham
                tbl.Text = name
                tbl.TextColor3 = theme.TextColor
                tbl.TextSize = 12
                tbl.TextXAlignment = Enum.TextXAlignment.Left

                tb.MouseEnter:Connect(function() Tween(tb, {BackgroundColor3 = theme.ElementColor:Lerp(Color3.new(1,1,1),0.08)}) end)
                tb.MouseLeave:Connect(function() Tween(tb, {BackgroundColor3 = theme.ElementColor}) end)

                tb.FocusLost:Connect(function(enter)
                    if enter and callback then callback(tb.Text) end
                end)

                local m = {}
                function m:Set(v) tb.Text = tostring(v) if callback then callback(tb.Text) end end
                function m:Get() return tb.Text end
                m.Frame = tbf
                return m
            end

            function section:NewSlider(name, min, max, default, callback)
                local sf = Instance.new("Frame")
                sf.Name = name.."_Slider"
                sf.Parent = secContent
                sf.BackgroundTransparency = 1
                sf.Size = UDim2.new(1,0,0,50)

                local st = Instance.new("TextLabel")
                st.Name = "Text"
                st.Parent = sf
                st.BackgroundTransparency = 1
                st.Size = UDim2.new(1,0,0.4,0)
                st.Font = Enum.Font.Gotham
                st.Text = name..": "..default
                st.TextColor3 = theme.TextColor
                st.TextSize = 14
                st.TextXAlignment = Enum.TextXAlignment.Left

                local bar = Instance.new("Frame")
                bar.Name = "Bar"
                bar.Parent = sf
                bar.BackgroundColor3 = theme.ElementColor
                bar.Size = UDim2.new(1,0,0.2,0)
                bar.Position = UDim2.new(0,0,0.6,0)

                local bc = Instance.new("UICorner")
                bc.Parent = bar

                local fill = Instance.new("Frame")
                fill.Name = "Fill"
                fill.Parent = bar
                fill.BackgroundColor3 = theme.SchemeColor
                fill.Size = UDim2.new(math.clamp((default-min)/(max-min),0,1),0,1,0)

                local fc = Instance.new("UICorner")
                fc.Parent = fill

                local dragging = false

                local function update(v)
                    local p = math.clamp((v - min)/(max - min), 0, 1)
                    Tween(fill, {Size = UDim2.new(p,0,1,0)})
                    st.Text = name..": "..math.floor(v)
                    if callback then callback(math.floor(v)) end
                end

                bar.InputBegan:Connect(function(i)
                    if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
                        dragging = true
                    end
                end)

                bar.InputEnded:Connect(function(i)
                    if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
                        dragging = false
                    end
                end)

                UserInputService.InputChanged:Connect(function(i)
                    if dragging and (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) then
                        local pos = i.Position.X - bar.AbsolutePosition.X
                        local p = math.clamp(pos / bar.AbsoluteSize.X, 0, 1)
                        local v = min + (max - min) * p
                        update(v)
                    end
                end)

                return sf
            end

            function section:NewKeybind(name, defaultKey, callback)
                local kf = Instance.new("Frame")
                kf.Name = name.."_Keybind"
                kf.Parent = secContent
                kf.BackgroundTransparency = 1
                kf.Size = UDim2.new(1,0,0,35)

                local kl = Instance.new("TextLabel")
                kl.Name = "Label"
                kl.Parent = kf
                kl.BackgroundTransparency = 1
                kl.Size = UDim2.new(0.6,0,1,0)
                kl.Font = Enum.Font.Gotham
                kl.Text = name
                kl.TextColor3 = theme.TextColor
                kl.TextSize = 14
                kl.TextXAlignment = Enum.TextXAlignment.Left

                local kb = Instance.new("TextButton")
                kb.Name = "Keybind"
                kb.Parent = kf
                kb.BackgroundColor3 = theme.ElementColor
                kb.Position = UDim2.new(1,-100,0,2.5)
                kb.Size = UDim2.new(0,90,0,30)
                kb.Font = Enum.Font.Gotham
                kb.TextColor3 = theme.TextColor
                kb.TextSize = 14
                kb.AutoButtonColor = false

                local kbc = Instance.new("UICorner")
                kbc.CornerRadius = UDim.new(0,4)
                kbc.Parent = kb

                local current = defaultKey or Enum.KeyCode.Unknown
                kb.Text = current.Name ~= "Unknown" and current.Name or "..."

                local listening = false

                kb.MouseButton1Click:Connect(function()
                    listening = true
                    kb.Text = "..."
                    Tween(kb, {BackgroundColor3 = theme.SchemeColor})
                end)

                local conn = UserInputService.InputBegan:Connect(function(input, gpe)
                    if listening and not gpe then
                        local k = input.KeyCode
                        if input.UserInputType == Enum.UserInputType.MouseButton1 then k = Enum.KeyCode.MouseButton1 end
                        if input.UserInputType == Enum.UserInputType.MouseButton2 then k = Enum.KeyCode.MouseButton2 end
                        current = k
                        kb.Text = k.Name ~= "Unknown" and k.Name or "[None]"
                        Tween(kb, {BackgroundColor3 = theme.ElementColor})
                        listening = false
                        if callback then callback(k) end
                    elseif not gpe and input.KeyCode == current and callback then
                        callback(current)
                    end
                end)

                kf.AncestryChanged:Connect(function(_,p) if not p then conn:Disconnect() end end)

                local m = {}
                function m:Set(k) current = k kb.Text = k.Name ~= "Unknown" and k.Name or "[None]" if callback then callback(k) end end
                function m:Get() return current end
                return m
            end

            return section
        end

        return tab
    end

    return lib
end

return SimpleKavo
